/*! ditherjs 2015-06-16 */
"use strict";var DitherJSInternals={palettes:{DOS_CGA:[[0,0,0],[255,0,255],[0,255,255],[255,255,255]],DOS_EGA:[[0,0,0],[0,0,170],[0,170,0],[0,170,170],[170,0,0],[170,0,170],[170,85,0],[170,170,170],[85,85,85],[85,85,255],[85,255,85],[85,255,255],[85,85,85],[255,85,255],[255,255,85],[255,255,255]],APPLE2:[[0,0,0],[114,38,64],[64,51,127],[228,52,254],[14,89,64],[127,127,127],[27,154,254],[191,179,255],[64,76,0],[228,101,1],[241,166,191],[27,203,1],[191,204,128],[141,217,191],[255,255,255]],C64:[[0,0,0],[255,255,255],[136,57,50],[103,182,189],[139,63,150],[85,160,73],[64,49,141],[191,206,114],[139,84,41],[87,66,1],[184,105,98],[80,80,80],[120,120,120],[148,224,137],[120,105,196],[159,159,159]]},algorithums:function(){var a=document.createElement("canvas").getContext("2d"),b=function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))},c=function(a,c){var d=function(a,b,c,e){if(2==c.length)return a(b,e)<=a(b,c[1])?e:c[1];var f=c.slice(1);return e=a(b,e)<=a(b,c[1])?e:c[1],d(a,b,f,e)},e=d(b,a,c,c[0]);return e};return{ordered:function(b,d,e,f,g){for(var h=a.createImageData(d,e),i=new Uint8ClampedArray(b.data),j=3,k=new Array([1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]),l=0;e>l;l+=g)for(var m=0;d>m;m+=g){var n=4*m+4*l*d,o=n,p=n+1,q=n+2;i[o]+=k[m%4][l%4]*j,i[p]+=k[m%4][l%4]*j,i[q]+=k[m%4][l%4]*j;for(var r=new Array(i[o],i[p],i[q]),s=c(r,f),t=s[0],u=s[1],v=s[2],w=0;g>w;w++)for(var x=0;g>x;x++){var y=n+4*w+4*d*x;i[y]=t,i[y+1]=u,i[y+2]=v}}return h.data.set(i),h},atkinson:function(b,d,e,f,g){for(var h=a.createImageData(d,e),i=new Uint8ClampedArray(b.data),j=new Uint8ClampedArray(b.data),k=1/8,l=0;e>l;l+=g)for(var m=0;d>m;m+=g){var n=4*m+4*l*d,o=function(a,b){return 4*a+4*b*d},p=n,q=n+1,r=n+2,s=new Array(i[p],i[q],i[r]),t=c(s,f),u=[];u[p]=i[p]-t[0],u[q]=i[q]-t[1],u[r]=i[r]-t[2],i[o(m+g,l)+0]+=k*u[p],i[o(m-g,l+g)+0]+=k*u[p],i[o(m,l+g)+0]+=k*u[p],i[o(m+g,l+g)+0]+=k*u[p],i[o(m+2*g,l)+0]+=k*u[p],i[o(m,l+2*g)+0]+=k*u[p],i[o(m+g,l)+1]+=k*u[p],i[o(m-g,l+g)+1]+=k*u[p],i[o(m,l+g)+1]+=k*u[p],i[o(m+g,l+g)+1]+=k*u[p],i[o(m+2*g,l)+1]+=k*u[p],i[o(m,l+2*g)+1]+=k*u[p],i[o(m+g,l)+2]+=k*u[p],i[o(m-g,l+g)+2]+=k*u[p],i[o(m,l+g)+2]+=k*u[p],i[o(m+g,l+g)+2]+=k*u[p],i[o(m+2*g,l)+2]+=k*u[p],i[o(m,l+2*g)+2]+=k*u[p];for(var v=t[0],w=t[1],x=t[2],y=0;g>y;y++)for(var z=0;g>z;z++){var A=n+4*y+4*d*z;j[A]=v,j[A+1]=w,j[A+2]=x}}return h.data.set(j),h},errorDiffusion:function(b,d,e,f,g){for(var h=a.createImageData(d,e),i=new Uint8ClampedArray(b.data),j=new Uint8ClampedArray(b.data),k=1/16,l=(new Array([1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]),0);e>l;l+=g)for(var m=0;d>m;m+=g){var n=4*m+4*l*d,o=function(a,b){return 4*a+4*b*d},p=n,q=n+1,r=n+2,s=new Array(i[p],i[q],i[r]),t=c(s,f),u=[];u[p]=i[p]-t[0],u[q]=i[q]-t[1],u[r]=i[r]-t[2],i[o(m+g,l)]=i[o(m+g,l)]+7*k*u[p],i[o(m-g,l+1)]=i[o(m-1,l+g)]+3*k*u[p],i[o(m,l+g)]=i[o(m,l+g)]+5*k*u[p],i[o(m+g,l+g)]=i[o(m+1,l+g)]+1*k*u[p],i[o(m+g,l)+1]=i[o(m+g,l)+1]+7*k*u[q],i[o(m-g,l+g)+1]=i[o(m-g,l+g)+1]+3*k*u[q],i[o(m,l+g)+1]=i[o(m,l+g)+1]+5*k*u[q],i[o(m+g,l+g)+1]=i[o(m+g,l+g)+1]+1*k*u[q],i[o(m+g,l)+2]=i[o(m+g,l)+2]+7*k*u[r],i[o(m-g,l+g)+2]=i[o(m-g,l+g)+2]+3*k*u[r],i[o(m,l+g)+2]=i[o(m,l+g)+2]+5*k*u[r],i[o(m+g,l+g)+2]=i[o(m+g,l+g)+2]+1*k*u[r];for(var v=t[0],w=t[1],x=t[2],y=0;g>y;y++)for(var z=0;g>z;z++){var A=n+4*y+4*d*z;j[A]=v,j[A+1]=w,j[A+2]=x}}return h.data.set(j),h}}}(),dither:function(a,b,c,d,e){var f=this.algorithums[b];if(!f)throw new Error("Not a valid algorithm",b,Object.keys(algorithums));var g=a.clientWidth||a.width||a.canvas.width,h=a.clientHeight||a.height||a.canvas.height;this.getContext=function(a){if(!a)return void 0;var b,c=a.constructor.name;return"CanvasRenderingContext2D"==c?b=a:"HTMLCanvasElement"==c&&(b=a.getContext("2d")),b?(b.imageSmoothingEnabled=!1,b):void 0};var i=this.getContext(a),j=i.getImageData(0,0,g,h),k=f(j,g,h,c,d),l=this.getContext(e)||i;l.putImageData(k,0,0)}},DitherJS=function(a,b){var c=this;c.opt=b||{},c.opt.step=c.opt.step||1,c.opt.className=c.opt.className||"dither",c.opt.algorithm=c.opt.algorithm||"ordered",c.opt.palette=c.opt.palette||DitherJSInternals.palettes.DOS_CGA,this.palette=c.opt.palette,this._refreshDither=function(a){a.src=a.src+"?"+Math.random(),a.onload=function(){var b=Date.now();c._dither(a),console.log("Microtime: ",Date.now()-b)}},this._dither=function(a,b,d,e,f){if(d=d||c.opt.palette,e=e||c.opt.step,b=b||c.opt.algorithm,"HTMLImageElement"==a.constructor.name){var g=document.createElement("canvas");g.height=a.clientHeight,g.width=a.clientWidth,a.parentNode.replaceChild(g,a),g.className=a.className.replace(c.opt.className," ");var h=g.getContext("2d");h.drawImage(a,0,0,g.width,g.height),a=h}DitherJSInternals.dither(a,b,d,e,f)};try{for(var d=document.querySelectorAll(a),e=0;e<d.length;e++)this._refreshDither(d[e])}catch(f){}};"function"==typeof define&&define.amd&&define("ditherjs",[],function(){return DitherJS}),"object"==typeof module&&module.exports&&(module.exports=DitherJS);